<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="/search.css" />
  </head>
  <body>
    <%- include('header.ejs') %>

    <main class="searchBody">
      <div class="container">
        <section class="row justify-content-center">
          <div class="select col-3">
            <div class="sel-social">
              <div class="title d-flex">
                <div class="square" style="background-color: rgb(234, 99, 99)"></div>
                <h4>소셜</h4>
              </div>

              <ul class="filterOption">
                <li class="filterBtn">
                  <div class="filterBtn-click d-flex">
                    <img src="/image/plus.png" alt="+" />
                    <p>내가좋아요한</p>
                  </div>
                </li>

                <li class="filterBtn">
                  <div class="filterBtn-click d-flex">
                    <img src="/image/plus.png" alt="+" />
                    <p>나의팔로우추천</p>
                  </div>
                </li>

                <li class="filterBtn">
                  <div class="filterBtn-click d-flex">
                    <img src="/image/plus.png" alt="+" />
                    <p>다코미식가추천</p>
                  </div>
                </li>
              </ul>
              <div class="bk"><hr /></div>
            </div>

            <div class="sel-user-age">
              <div class="title d-flex">
                <div class="square" style="background-color: rgb(255, 125, 60)"></div>
                <h4>이용자층</h4>
              </div>

              <ul class="gender row">
                <div class="form-check col">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" />
                  <label class="form-check-label" for="flexRadioDefault1"> 남자 </label>
                </div>
                <div class="form-check col">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" />
                  <label class="form-check-label" for="flexRadioDefault1"> 여자 </label>
                </div>
              </ul>
              <div class="bk"><hr /></div>
            </div>

            <ul class="peopleGroup row">
              <div class="form-check col-6">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
                <label class="form-check-label" for="flexCheckDefault"> 20대 </label>
              </div>
              <div class="form-check col-6">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
                <label class="form-check-label" for="flexCheckDefault"> 30대 </label>
              </div>
              <div class="form-check col-6">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
                <label class="form-check-label" for="flexCheckDefault"> 40대 </label>
              </div>
              <div class="form-check col-6">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
                <label class="form-check-label" for="flexCheckDefault"> 50대 </label>
              </div>
              <div class="form-check col-6">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" />
                <label class="form-check-label" for="flexCheckDefault"> 60대 이상 </label>
              </div>

              <li class="filterBtn col-6"></li>
            </ul>
            <div class="bk"><hr /></div>

            <div class="sel-category">
              <div class="title d-flex">
                <div class="square" style="background-color: rgb(251, 201, 68)"></div>
                <h4>카테고리</h4>
              </div>
              <ul class="categoryGroup row">
                <li class="filterBtn col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault2" />
                    <label class="form-check-label" for="flexCheckDefault"> 한식 </label>
                  </div>
                </li>
                <li class="filterBtn col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault2" />
                    <label class="form-check-label" for="flexCheckDefault"> 일식 </label>
                  </div>
                </li>
                <li class="filterBtn col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault2" />
                    <label class="form-check-label" for="flexCheckDefault"> 중식 </label>
                  </div>
                </li>
                <li class="filterBtn col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault2" />
                    <label class="form-check-label" for="flexCheckDefault"> 아시안 </label>
                  </div>
                </li>
                <li class="filterBtn col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault2" />
                    <label class="form-check-label" for="flexCheckDefault"> 디저트 </label>
                  </div>
                </li>
              </ul>
              <div class="dk"><hr /></div>
            </div>

            <div class="sel-location">
              <div class="title d-flex">
                <div class="square" style="background-color: rgb(67, 163, 147)"></div>
                <h4>지역</h4>
              </div>
              <div class="dropdown">
                <button class="btn dropdown-toggle question" type="button" data-bs-toggle="dropdown">
                  <span>광역시도</span>
                </button>
                <ul class="dropdown-menu city_list" data-popper-placement="bottom-start">
                  <li>서울</li>
                  <li>경기</li>
                  <li>인천</li>
                  <li>강원</li>
                  <li>세종</li>
                  <li>부산</li>
                  <li>경남</li>
                  <li>경북</li>
                  <li>광주</li>
                  <li>전주</li>
                  <li>목포</li>
                  <li>전라</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="col-9">
            <div class="food-shop">
              <div class="order-wrap row">
                <div class="l-btn d-flex">
                  <div class="range">
                    <span><img src="/image/tab.png" alt="정렬" />정렬</span>
                  </div>
                  <div class="order">
                    <button class="grade"><span>평점순</span></button>
                    <button class="review"><span>리뷰많은순</span></button>
                    <button class="like"><span>좋아요많은순</span></button>
                    <button class="load"><span>조회순</span></button>
                  </div>
                </div>
              </div>
              <div class="r-btn col" id="map"><%- include('maps.ejs') %></div>
              <div class="select-shop">
                <ul class="shop-box">
                  <li class="look-shop">
                    <% shops.forEach(shop => { %>
                    <a href="/detail/<%= shop.restaurantId %>" class="search">
                      <div class="shop-h row">
                        <% if (shop.Images && shop.Images.length > 1) { %>
                        <img
                          src="/test/<%= shop.Images[shop.Images.length-1].imgUrl %>"
                          alt="<%= shop.restaurantName %>"
                          class="col-3 title-img"
                        />
                        <% } else if (shop.Images && shop.Images.length > 0) { %>
                        <!-- 만약 첫 번째 이미지만 존재한다면, 첫 번째 이미지를 사용 -->
                        <img
                          src="/test/<%= shop.Images[0].imgUrl %>"
                          alt="<%= shop.restaurantName %>"
                          class="col-3 title-img"
                        />
                        <% } else { %>
                        <!-- 이미지가 없을 경우의 대체 이미지 또는 대체 텍스트 -->
                        <img src="/path/to/default/image.png" alt="Default Image" class="col-3 title-img" />
                        <% } %>

                        <div class="info col-9">
                          <h3 class="shop-name"><%= shop.restaurantName %></h3>
                          <p class="category"><%= shop.category %></p>
                          <p class="hash"><%= shop.hashTags %></p>

                          <div class="rate d-flex">
                            <p class="score"><span><%= shop.score %></span>점</p>
                            <p class="user-score">
                              <img src="/image/star.png" alt="" /><%= shop.userScore %> (<%= shop.reviewCount %>명)
                            </p>
                            <p class="heart">
                              <img src="/image/heart.png" alt="" /><span><%= shop.favoriteCount %></span>
                            </p>
                          </div>
                        </div>
                        <div class="body">
                          <span> "<%= shop.reviewContent %>" </span>
                        </div>
                      </div>
                      <% }); %>
                      <div class="shop-b"></div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>

            <div class="request">
              <div div class="inner">
                <h1>찾으시는 식당이 없으신가요?</h1>
                <div class="request-btn">
                  <button><a href="/add">맛집 등록 요청하기</a></button>
                </div>
                <span>보통 당일 등록이 이루어지며, 등록 시 즉시 푸시 알림을 드립니다.</span>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <%- include('footer.ejs') %>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script>
    let question = document.getElementsByClassName('question');

    for (let i = 0; i < question.length; i++) {
      question[i].addEventListener('click', function () {
        let answer = this.nextElementSibling;

        questionClose(i, question);
        questionOpen(question[i], answer);
      });
    }

    const cityList = document.querySelector('.city_list');
    const button = document.querySelector('.question span');

    cityList.addEventListener('click', function (event) {
      if (event.target.tagName === 'LI') {
        button.textContent = event.target.textContent;
      }
    });

    // 평점순으로 정렬하는 함수
    function sortByGrade(shops) {
      return shops.sort((a, b) => b.grade - a.grade);
    }

    // 버튼 요소를 가져와서 클릭 이벤트를 등록합니다.
    const gradeButton = document.querySelector('.grade');

    gradeButton.addEventListener('click', function () {
      console.log('평점순으로 정렬합니다.');
      sortByGrade;
      console.log(sortByGrade(shops));
    });
  </script>
</html>
